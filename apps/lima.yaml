name: lima

command: limactl

# cf. https://lima-vm.io/docs/installation/
install:
  - type: brew
    package: lima
    os: macos

  - type: custom
    os: linux
    check: command -v limactl
    version_cmd: limactl --version 2>/dev/null | awk '{print $3}'
    latest_cmd: curl -sS --max-time 10 "https://api.github.com/repos/lima-vm/lima/releases/latest" | jq -r '.tag_name | ltrimstr("v")'
    script: |
      VERSION=$(curl -fsSL https://api.github.com/repos/lima-vm/lima/releases/latest | jq -r .tag_name)
      curl -fsSL "https://github.com/lima-vm/lima/releases/download/${VERSION}/lima-${VERSION:1}-$(uname -s)-$(uname -m).tar.gz" \
        | sudo tar Cxzvm /usr/local
    uninstall: |
      sudo rm -f /usr/local/bin/lima* /usr/local/bin/limactl
      sudo rm -rf /usr/local/share/lima /usr/local/share/doc/lima
