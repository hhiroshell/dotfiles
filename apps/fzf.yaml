name: fzf

version:
  policy: latest

# cf. https://github.com/junegunn/fzf#installation
install:
  - type: brew
    package: fzf
    os: macos

  - type: custom
    os: linux
    check: command -v fzf
    version_cmd: fzf --version 2>/dev/null | awk '{print $1}'
    latest_cmd: curl -sS --max-time 10 "https://api.github.com/repos/junegunn/fzf/releases/latest" | jq -r '.tag_name | ltrimstr("v")'
    script: |
      FZF_VERSION=$(curl -sS --max-time 10 "https://api.github.com/repos/junegunn/fzf/releases/latest" | jq -r '.tag_name | ltrimstr("v")')
      curl -Lo /tmp/fzf.tar.gz "https://github.com/junegunn/fzf/releases/latest/download/fzf-${FZF_VERSION}-linux_amd64.tar.gz"
      tar xf /tmp/fzf.tar.gz -C /tmp fzf
      sudo install /tmp/fzf /usr/local/bin
      rm /tmp/fzf.tar.gz /tmp/fzf
    uninstall: |
      sudo rm -f /usr/local/bin/fzf
