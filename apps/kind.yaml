name: kind

version:
  policy: latest

# cf. https://kind.sigs.k8s.io/docs/user/quick-start/#installation
install:
  - type: brew
    package: kind
    os: macos

  - type: custom
    os: linux
    check: command -v kind
    version_cmd: kind version 2>/dev/null | awk '{print $2}'
    latest_cmd: curl -sS --max-time 10 "https://api.github.com/repos/kubernetes-sigs/kind/releases/latest" | jq -r '.tag_name'
    script: |
      KIND_VERSION=$(curl -sS "https://api.github.com/repos/kubernetes-sigs/kind/releases/latest" | jq -r '.tag_name')
      curl -Lo /tmp/kind "https://kind.sigs.k8s.io/dl/${KIND_VERSION}/kind-linux-amd64"
      chmod +x /tmp/kind
      sudo mv /tmp/kind /usr/local/bin/kind
    uninstall: |
      sudo rm -f /usr/local/bin/kind
