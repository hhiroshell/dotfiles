name: yq

# cf. https://github.com/mikefarah/yq#install
install:
  - type: brew
    package: yq
    os: macos

  - type: custom
    os: linux
    check: command -v yq
    version_cmd: yq --version 2>/dev/null | awk '{print $NF}' | sed 's/^v//'
    latest_cmd: curl -sS --max-time 10 "https://api.github.com/repos/mikefarah/yq/releases/latest" | jq -r '.tag_name | ltrimstr("v")'
    script: |
      curl -Lo /tmp/yq https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64
      sudo install /tmp/yq /usr/local/bin/yq
      rm /tmp/yq
    uninstall: |
      sudo rm -f /usr/local/bin/yq
