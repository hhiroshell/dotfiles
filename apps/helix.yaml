name: helix

command: hx

version:
  policy: latest

# cf. https://docs.helix-editor.com/install.html
install:
  - type: brew
    package: helix
    os: macos

  - type: custom
    os: linux
    check: command -v hx
    version_cmd: hx --version 2>/dev/null | head -1 | awk '{print $2}'
    latest_cmd: curl -sS --max-time 10 "https://api.github.com/repos/helix-editor/helix/releases/latest" | jq -r '.tag_name'
    script: |
      HELIX_VERSION=$(curl -s "https://api.github.com/repos/helix-editor/helix/releases/latest" | grep -Po '"tag_name": "\K[^"]*')
      curl -Lo /tmp/helix.AppImage "https://github.com/helix-editor/helix/releases/download/${HELIX_VERSION}/helix-${HELIX_VERSION}-x86_64.AppImage"
      sudo install /tmp/helix.AppImage /usr/local/bin/hx
      rm /tmp/helix.AppImage
    uninstall: |
      sudo rm -f /usr/local/bin/hx
